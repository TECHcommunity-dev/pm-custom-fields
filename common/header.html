<script type="text/discourse-plugin" version="0.8">
  api.modifyClass('model:composer', {
    pluginId: 'custom-composer',
    save() {
      return new Promise((resolve, reject) => {
            if(this.action == "privateMessage" || (this.action == "reply" && this.get('privateMessage') == true)) {
      const customFieldValue2 = document.getElementById('custom-field-input').value;
      const errorMessage = document.getElementsByClassName('error-message')[0];
      const customInput = document.getElementById('custom-field-input');

      if (!customFieldValue2) {
          // Prevent submission and show error message
          errorMessage.style.display = 'block';
          customInput.focus();
          reject(new Error('Custom field is required.'));
      } else {
          // Hide error message
          errorMessage.style.display = 'none';
      }  

      this.set('customFieldValue', customFieldValue2);
      this.set('reply', this.get('reply') + `\n\nProduct Name: ${this.get('customFieldValue')}`);
      this._super(...arguments); // Call the original save method
    }
      }).catch(error => {
        console.error(error.message);
        // Ensuring rejection is handled properly
        return new Promise((res, rej) => rej(error));
      });
    }
 });
</script>
